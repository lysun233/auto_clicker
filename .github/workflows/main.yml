name: åˆ†åˆ«æž„å»ºå¹¶å‘å¸ƒæ¯ä¸ª EXE

on:
  push:
    paths:
      - '**.cpp'
    branches:
      - main  # ä¿®æ”¹ä¸ºä½ çš„ä¸»åˆ†æ”¯åï¼ˆå¦‚ masterï¼‰

jobs:
  build-and-release:
    runs-on: windows-latest

    steps:
      - name: æ‹‰å–ä»£ç 
        uses: actions/checkout@v3

      - name: å®‰è£… MinGW ç¼–è¯‘å™¨
        uses: egor-tensin/setup-mingw@v2
        with:
          platform: x64

      - name: å®‰è£… gh CLIï¼ˆGitHub å‘½ä»¤è¡Œå·¥å…·ï¼‰
        uses: cli/cli-action@v2

      - name: ç¼–è¯‘å¹¶å‘å¸ƒæ¯ä¸ª EXE
        shell: pwsh
        run: |
          Get-ChildItem -Filter *.cpp | ForEach-Object {
            $cpp = $_.Name
            $basename = $_.BaseName
            $exe = "$basename.exe"

            Write-Host "ðŸ”§ ç¼–è¯‘ $cpp ä¸º $exe"
            g++ $cpp -o $exe

            Write-Host "ðŸš€ å‘å¸ƒ Release: $basename"
            gh release delete "$basename" -y -R $env:GITHUB_REPOSITORY 2>$null
            gh release create "$basename" "$exe" --title "$basename" --notes "ç”± GitHub Actions è‡ªåŠ¨æž„å»º"
          }
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
